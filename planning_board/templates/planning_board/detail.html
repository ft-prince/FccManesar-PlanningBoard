{% extends 'planning_board/base.html' %}

{% block title %}Dashboard - Planning Board{% endblock %}

{% block extra_css %}
<style>
    /* Dashboard specific styles - scoped to avoid conflicts */
    .dashboard-container .dashboard-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .dashboard-container .dashboard-stats-card {
        border: none;
        border-radius: 20px;
        transition: all 0.3s ease;
        background: white;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        overflow: hidden;
        position: relative;
        margin-bottom: 1.5rem;
    }
    
    .dashboard-container .dashboard-stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }
    
    .dashboard-container .dashboard-stats-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2);
    }
    
    .dashboard-container .dashboard-stats-card .card-body {
        padding: 2rem;
    }
    
    .dashboard-container .dashboard-stats-number {
        font-size: 3rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 0.5rem;
        line-height: 1;
    }
    
    .dashboard-container .dashboard-stats-label {
        font-size: 1.1rem;
        color: #7f8c8d;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0;
    }
    
    .dashboard-container .dashboard-stats-icon {
        font-size: 4rem;
        opacity: 0.1;
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
    }
    
    .dashboard-container .dashboard-filter-section {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    
    .dashboard-container .dashboard-main-card {
        border: none;
        border-radius: 20px;
        background: white;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        overflow: hidden;
    }
    
    .dashboard-container .dashboard-main-card .card-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 2rem;
    }
    
    .dashboard-container .dashboard-table {
        margin: 0;
    }
    
    .dashboard-container .dashboard-table thead th {
        background: #f8f9fa;
        border: none;
        padding: 1.5rem 1rem;
        font-weight: 600;
        color: #2c3e50;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.9rem;
    }
    
    .dashboard-container .dashboard-table tbody td {
        padding: 1.5rem 1rem;
        border-top: 1px solid #e9ecef;
        vertical-align: middle;
    }
    
    .dashboard-container .dashboard-table tbody tr:hover {
        background: #f8f9fa;
    }
    
    .dashboard-container .dashboard-btn-action {
        border-radius: 10px;
        padding: 0.5rem 1rem;
        font-weight: 500;
        transition: all 0.3s ease;
        border: none;
        margin-right: 0.5rem;
    }
    
    .dashboard-container .dashboard-btn-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .dashboard-container .dashboard-btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .dashboard-container .dashboard-btn-success {
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        color: white;
    }
    
    .dashboard-container .dashboard-btn-info {
        background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%);
        color: white;
    }
    
    .dashboard-container .dashboard-empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #7f8c8d;
    }
    
    .dashboard-container .dashboard-empty-icon {
        font-size: 6rem;
        margin-bottom: 2rem;
        opacity: 0.3;
    }
    
    .dashboard-container .dashboard-form-control {
        border-radius: 10px;
        border: 2px solid #e9ecef;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
    }
    
    .dashboard-container .dashboard-form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .dashboard-container .dashboard-filter-buttons {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .dashboard-container .dashboard-filter-btn {
        border-radius: 25px;
        padding: 0.5rem 1.5rem;
        border: 2px solid #e9ecef;
        background: white;
        color: #6c757d;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .dashboard-container .dashboard-filter-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
    }
    
    .dashboard-container .dashboard-filter-btn:hover {
        border-color: #667eea;
        color: #667eea;
    }
    
    .dashboard-container .dashboard-date-badge {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 0.5rem;
        text-align: center;
        min-width: 60px;
    }
    
    .dashboard-container .dashboard-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }
    
    @media (max-width: 768px) {
        .dashboard-container .dashboard-stats-grid {
            grid-template-columns: 1fr;
        }
        
        .dashboard-container .dashboard-header {
            padding: 1.5rem 0;
        }
        
        .dashboard-container .dashboard-stats-number {
            font-size: 2.5rem;
        }
        
        .dashboard-container .dashboard-filter-buttons {
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-4 mb-2">Production Planning Dashboard</h1>
                    <p class="lead mb-0">Manage your production schedules and planning boards efficiently</p>
                </div>
                <div class="col-lg-4 text-lg-end">
                    <a href="{% url 'planning_board:create' %}" class="btn btn-light btn-lg">
                        <i class="fas fa-plus me-2"></i> Create New Board
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="dashboard-stats-grid">
        <div class="dashboard-stats-card">
            <div class="card-body">
                <div class="dashboard-stats-number">{{ total_boards }}</div>
                <div class="dashboard-stats-label">Total Planning Boards</div>
                <i class="fas fa-clipboard-list dashboard-stats-icon"></i>
            </div>
        </div>
        
        <div class="dashboard-stats-card">
            <div class="card-body">
                <div class="dashboard-stats-number">{{ total_production_lines }}</div>
                <div class="dashboard-stats-label">Production Lines</div>
                <i class="fas fa-industry dashboard-stats-icon"></i>
            </div>
        </div>
        
        <div class="dashboard-stats-card">
            <div class="card-body">
                <div class="dashboard-stats-number">{{ recent_boards.count }}</div>
                <div class="dashboard-stats-label">Recent Boards</div>
                <i class="fas fa-clock dashboard-stats-icon"></i>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="dashboard-filter-section">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h5 class="mb-3">Filter Planning Boards</h5>
                <div class="dashboard-filter-buttons">
                    <button class="dashboard-filter-btn active" data-filter="today">Today</button>
                    <button class="dashboard-filter-btn" data-filter="week">This Week</button>
                    <button class="dashboard-filter-btn" data-filter="month">This Month</button>
                    <button class="dashboard-filter-btn" data-filter="all">All Time</button>
                </div>
            </div>
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">From Date</label>
                        <input type="date" class="form-control dashboard-form-control" id="fromDate" name="from_date">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">To Date</label>
                        <input type="date" class="form-control dashboard-form-control" id="toDate" name="to_date">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Table -->
    <div class="dashboard-main-card">
        <div class="card-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 class="mb-0">Planning Boards</h4>
                    <p class="mb-0 opacity-75">Manage and track your production planning boards</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="dropdown">
                        <button class="btn btn-light dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown">
                            <i class="fas fa-download me-2"></i> Export
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-file-excel me-2"></i> Excel</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-file-pdf me-2"></i> PDF</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-file-csv me-2"></i> CSV</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            {% if recent_boards %}
                <div class="table-responsive">
                    <table class="table dashboard-table" id="planningBoardsTable">
                        <thead>
                            <tr>
                                <th>
                                    <i class="fas fa-calendar-alt me-2"></i>Date
                                </th>
                                <th>
                                    <i class="fas fa-file-alt me-2"></i>Title
                                </th>
                                <th>
                                    <i class="fas fa-clock me-2"></i>Meeting Time
                                </th>
                                <th>
                                    <i class="fas fa-plus-circle me-2"></i>Created
                                </th>
                                <th>
                                    <i class="fas fa-user me-2"></i>Status
                                </th>
                                <th>
                                    <i class="fas fa-cogs me-2"></i>Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for board in recent_boards %}
                                <tr data-date="{{ board.today_date|date:'Y-m-d' }}">
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="dashboard-date-badge me-3">
                                                <div class="text-muted small">{{ board.today_date|date:"M" }}</div>
                                                <div class="h5 mb-0">{{ board.today_date|date:"d" }}</div>
                                            </div>
                                            <div>
                                                <div class="fw-bold">{{ board.today_date|date:"l" }}</div>
                                                <div class="text-muted small">{{ board.today_date|date:"Y" }}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="fw-bold">{{ board.title|truncatechars:40 }}</div>
                                        {% if board.description %}
                                            <div class="text-muted small">{{ board.description|truncatechars:60 }}</div>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if board.meeting_time %}
                                            <span class="badge bg-success">{{ board.meeting_time }}</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Not Set</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="text-muted small">{{ board.created_at|date:"M d, Y" }}</div>
                                        <div class="text-muted small">{{ board.created_at|date:"H:i" }}</div>
                                    </td>
                                    <td>
                                        {% if board.today_date|date:"Y-m-d" == today %}
                                            <span class="badge bg-primary">Today</span>
                                        {% elif board.today_date|date:"Y-m-d" > today %}
                                            <span class="badge bg-warning">Upcoming</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Past</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <a href="{% url 'planning_board:detail' board.pk %}" class="btn btn-sm dashboard-btn-action dashboard-btn-primary" title="View Details">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="{% url 'planning_board:edit' board.pk %}" class="btn btn-sm dashboard-btn-action dashboard-btn-success" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button class="btn btn-sm dashboard-btn-action dashboard-btn-info" title="Duplicate" onclick="duplicateBoard({{ board.pk }})">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="dashboard-empty-state">
                    <i class="fas fa-clipboard-list dashboard-empty-icon"></i>
                    <h3>No Planning Boards Found</h3>
                    <p class="mb-4">Get started by creating your first planning board or uploading an Excel file.</p>
                    <div class="d-flex justify-content-center gap-3">
                        <a href="{% url 'planning_board:create' %}" class="btn dashboard-btn-primary btn-lg">
                            <i class="fas fa-plus me-2"></i> Create New Board
                        </a>
                        <a href="{% url 'planning_board:excel_upload' %}" class="btn dashboard-btn-success btn-lg">
                            <i class="fas fa-file-excel me-2"></i> Upload Excel
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set today's date as default
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('fromDate').value = today;
    document.getElementById('toDate').value = today;
    
    // Filter functionality
    const filterButtons = document.querySelectorAll('.dashboard-filter-btn');
    const fromDate = document.getElementById('fromDate');
    const toDate = document.getElementById('toDate');
    const tableRows = document.querySelectorAll('#planningBoardsTable tbody tr');
    
    // Apply today filter by default
    filterByDate('today');
    
    filterButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            filterButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const filter = this.dataset.filter;
            filterByDate(filter);
        });
    });
    
    fromDate.addEventListener('change', customDateFilter);
    toDate.addEventListener('change', customDateFilter);
    
    function filterByDate(filter) {
        const today = new Date();
        let startDate, endDate;
        
        switch(filter) {
            case 'today':
                startDate = new Date(today);
                endDate = new Date(today);
                break;
            case 'week':
                startDate = new Date(today);
                startDate.setDate(today.getDate() - today.getDay());
                endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + 6);
                break;
            case 'month':
                startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                break;
            case 'all':
                showAllRows();
                return;
        }
        
        if (filter !== 'all') {
            fromDate.value = startDate.toISOString().split('T')[0];
            toDate.value = endDate.toISOString().split('T')[0];
            applyDateFilter(startDate, endDate);
        }
    }
    
    function customDateFilter() {
        if (fromDate.value && toDate.value) {
            const startDate = new Date(fromDate.value);
            const endDate = new Date(toDate.value);
            applyDateFilter(startDate, endDate);
            
            // Update button state
            filterButtons.forEach(b => b.classList.remove('active'));
        }
    }
    
    function applyDateFilter(startDate, endDate) {
        tableRows.forEach(row => {
            const rowDate = new Date(row.dataset.date);
            if (rowDate >= startDate && rowDate <= endDate) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }
    
    function showAllRows() {
        tableRows.forEach(row => {
            row.style.display = '';
        });
    }
});

function duplicateBoard(boardId) {
    if (confirm('Are you sure you want to duplicate this planning board?')) {
        // Add your duplicate logic here
        console.log('Duplicating board:', boardId);
    }
}
</script>
{% endblock %}